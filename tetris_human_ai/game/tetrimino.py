import random
from typing import List, Tuple

from attr import attrs, attrib
import pygame


S = [[(2, 2), (3, 2), (1, 3), (2, 3)], [(2, 1), (2, 2), (3, 2), (3, 3)]]
#     [['.....',
#       '.....',
#       '..00.',
#       '.00..',
#       '.....'],
#      ['.....',
#       '..0..',
#       '..00.',
#       '...0.',
#       '.....']]

Z = [[(1, 2), (2, 2), (2, 3), (3, 3)], [(2, 1), (1, 2), (2, 2), (1, 3)]]
# [['.....',
#   '.....',
#   '.00..',
#   '..00.',
#   '.....'],
#  ['.....',
#   '..0..',
#   '.00..',
#   '.0...',
#   '.....']]

I = [[(2, 0), (2, 1), (2, 2), (2, 3)], [(0, 1), (1, 1), (2, 1), (3, 1)]]
# [['..0..',
#   '..0..',
#   '..0..',
#   '..0..',
#   '.....'],
#  ['.....',
#   '0000.',
#   '.....',
#   '.....',
#   '.....']]

O = [[(1, 2), (2, 2), (1, 3), (2, 3)]]
# [['.....',
#   '.....',
#   '.00..',
#   '.00..',
#   '.....']]

J = [[(1, 1), (1, 2), (2, 2), (3, 2)], [(2, 1), (3, 1), (2, 2), (2, 3)],
     [(1, 2), (2, 2), (3, 2), (3, 3)], [(2, 1), (2, 2), (1, 3), (2, 3)]]
# [['.....',
#   '.0...',
#   '.000.',
#   '.....',
#   '.....'],
#  ['.....',
#   '..00.',
#   '..0..',
#   '..0..',
#   '.....'],
#  ['.....',
#   '.....',
#   '.000.',
#   '...0.',
#   '.....'],
#  ['.....',
#   '..0..',
#   '..0..',
#   '.00..',
#   '.....']]

L = [[(3, 1), (1, 2), (2, 2), (3, 2)], [(2, 1), (2, 2), (2, 3), (3, 3)],
     [(1, 2), (2, 2), (3, 2), (1, 3)], [(1, 1), (2, 1), (2, 2), (2, 3)]]
# [['.....',
#   '...0.',
#   '.000.',
#   '.....',
#   '.....'],
#  ['.....',
#   '..0..',
#   '..0..',
#   '..00.',
#   '.....'],
#  ['.....',
#   '.....',
#   '.000.',
#   '.0...',
#   '.....'],
#  ['.....',
#   '.00..',
#   '..0..',
#   '..0..',
#   '.....']]

T = [[(2, 1), (1, 2), (2, 2), (3, 2)], [(2, 1), (2, 2), (3, 2), (2, 3)],
     [(1, 2), (2, 2), (3, 2), (2, 3)], [(2, 1), (1, 2), (2, 2), (2, 3)]]
# [['.....',
#   '..0..',
#   '.000.',
#   '.....',
#   '.....'],
#  ['.....',
#   '..0..',
#   '..00.',
#   '..0..',
#   '.....'],
#  ['.....',
#   '.....',
#   '.000.',
#   '..0..',
#   '.....'],
#  ['.....',
#   '..0..',
#   '.00..',
#   '..0..',
#   '.....']]

shapes = [(S, (0, 255, 0)), (Z, (255, 0, 0)), (I, (0, 255, 255)), (O, (255, 255, 0)), (J, (255, 165, 0)), (L, (0, 0, 255)), (T, (128, 0, 128))]


@attrs
class Tetrimino:
    x: int = attrib(converter=int)
    y: int = attrib(converter=int)
    shape: List[List[Tuple[int, int]]] = attrib()
    color: Tuple[int, int, int] = attrib()
    rotation: int = attrib(converter=int)

    @staticmethod
    def random_shape():
        new_shape = random.choice(shapes)
        return Tetrimino(x=0, y=5, shape=new_shape[0], color=new_shape[1], rotation=0)

    def draw(self, surface):
            font = pygame.font.SysFont('comicsans', 30)
            label = font.render('Next Shape', 1, (255,255,255))

            sx = top_left_x + play_width + 50
            sy = top_left_y + play_height/2 - 100
            format = shape.shape[shape.rotation % len(shape.shape)]

            for i, line in enumerate(format):
                row = list(line)
                for j, column in enumerate(row):
                    if column == '0':
                        pygame.draw.rect(surface, shape.color, (sx + j*30, sy + i*30, 30, 30), 0)

            surface.blit(label, (sx + 10, sy- 30))
